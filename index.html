<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BDIXscannerWeb</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <h1># BDIXscannerWeb</h1>
  <span class="creatorname">By Tawsif Torabi</span>
  <h3 style="font-size: 13px;">Get the list of possible available BDIX server from your ISP</h3>
  <div id="progressBar">
    <div id="progress">0%</div>
  </div>
  <div id="currentUrl"></div>
  <div style="margin-top: 14px;">
    Request Timeout: <input type="number" value="5" id="timeOutValue"> sec.
  </div>
  <div style="margin-top: 10px;">
    <label for="autoscroll">Autoscroll:</label>
    <input type="checkbox" id="autoscroll" checked> <!-- Set to checked by default -->
  </div>
	<div style="width: 49%; display: inline-block;"> 
	  <ul id="urlList" style="overflow: scroll; height: 35em; border: 1px solid; overflow-x: auto;">
		<!-- URLs will be populated here -->
	  </ul>
	</div>
	<div style="width: 49%; display: inline-block;">
	  <ul id="urlList2" style="overflow: scroll; height: 35em; border: 1px solid; overflow-x: auto;">
		<!-- URLs will be populated here -->
	  </ul>
	</div>
  <script>
    let totalUrls;
    let processedUrls = 0;

    document.addEventListener("DOMContentLoaded", function() {
      fetch("bdix_server_list.txt")
        .then(response => response.text())
        .then(text => {
          const urls = text.trim().split('\n');
          totalUrls = urls.length;
          processUrlsSequentially(urls);
        })
        .catch(error => {
          console.error("Error fetching URL list:", error);
        });
    });

    function processUrlsSequentially(urls) {
      const url = urls.shift();
      if (url) {
        console.log("Checking URL:", url.trim());
        document.getElementById('currentUrl').textContent = "Current URL: " + url.trim();
        checkUrl(url.trim())
          .then(() => {
            processUrlsSequentially(urls);
          });
      }
    }

    function checkUrl(url) {
      let timeOutValue = document.getElementById('timeOutValue').value*1000;

      return new Promise((resolve, reject) => {
        const controller = new AbortController();
        const signal = controller.signal;

        setTimeout(() => {
          controller.abort();
        }, timeOutValue);

        console.log("Fetching URL:", url);
        fetch(url, { method: 'HEAD', mode: 'no-cors', signal })
          .then(response => {
            console.log("Response for", url, ":", response);
            setStatus(url, response.status, 'online');
            resolve();
          })
          .catch((error) => {
            console.error("Error fetching URL:", url, error);
            setStatus(url, 0, 'offline');
            resolve();
          });
      });
    }

    function setStatus(url, responseCode, status) {
      console.log("Setting status for URL:", url, "to", status);
      processedUrls++;
      const progress = Math.round((processedUrls / totalUrls) * 100);
      document.getElementById('progress').style.width = progress + "%";
      document.getElementById('progress').textContent = progress + "%";
      
      const listItem = document.createElement('li');
      
      if (status === 'online') {
        listItem.classList.add('online');
		listItem.innerHTML = "<a target='_blank' href='"+url+"'>"+url+" (Online)</a>";
		document.getElementById('urlList').appendChild(listItem);
      } else {
        listItem.classList.add('offline');
        listItem.innerHTML = "<a target='_blank' href='"+url+"'>"+url+" (Offline)</a>";
		document.getElementById('urlList2').appendChild(listItem);
      }
      
      if (document.getElementById('autoscroll').checked) {
        const urlList = document.getElementById('urlList');
        const urlList2 = document.getElementById('urlList2');
        urlList.scrollTop = urlList.scrollHeight;
        urlList2.scrollTop = urlList2.scrollHeight;
      }
    }
  </script>
</body>
</html>
